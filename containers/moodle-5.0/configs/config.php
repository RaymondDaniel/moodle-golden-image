dbtype = 'mysqli'; $CFG->dblibrary = 'native'; $CFG->dbhost = getenv('DB_HOST') ?: 'localhost'; $CFG->dbname = getenv('DB_NAME') ?: 'moodle'; $CFG->dbuser = getenv('DB_USER') ?: 'moodleuser'; $CFG->dbpass = getenv('DB_PASSWORD') ?: ''; $CFG->prefix = 'mdl_'; $CFG->dboptions = array ( 'dbpersist' => 0, 'dbport' => '', 'dbsocket' => '', 'dbcollation' => 'utf8mb4_unicode_ci', ); // Site configuration $CFG->wwwroot = getenv('MOODLE_URL') ?: 'https://moodle.dae.com'; $CFG->dataroot = '/var/moodledata'; $CFG->admin = 'admin'; // Security $CFG->directorypermissions = 0777; $CFG->passwordsaltmain = getenv('PASSWORD_SALT') ?: 'changeme'; // Performance settings $CFG->cachedir = '/tmp/moodle'; $CFG->tempdir = '/tmp/moodle'; $CFG->backuptempdir = '/tmp/moodle'; // Redis session configuration $CFG->session_handler_class = '\\core\\session\\redis'; $CFG->session_redis_host = getenv('REDIS_HOST') ?: '127.0.0.1'; $CFG->session_redis_port = 6379; $CFG->session_redis_auth = getenv('REDIS_AUTH') ?: ''; $CFG->session_redis_database = 0; $CFG->session_redis_acquire_lock_timeout = 120; $CFG->session_redis_lock_expire = 7200; // Cloud Storage configuration for large files $CFG->alternative_file_system_class = '\\tool_objectfs\\gcs_file_system'; $CFG->tool_objectfs = [ 'enabletasks' => true, 'enablelogging' => true, 'key_provider' => '\\tool_objectfs\\gcs_key_provider', 'gcs_bucket' => getenv('GCS_UPLOADS_BUCKET'), 'gcs_key_file' => '/var/secrets/gcs-key.json', 'sizethreshold' => 104857600, // 100MB threshold ]; // Email configuration $CFG->smtphosts = getenv('SMTP_HOST') ?: 'smtp.gmail.com:587'; $CFG->smtpsecure = 'tls'; $CFG->smtpauthtype = 'LOGIN'; $CFG->smtpuser = getenv('SMTP_USER') ?: ''; $CFG->smtppass = getenv('SMTP_PASSWORD') ?: ''; $CFG->noreplyaddress = getenv('NOREPLY_EMAIL') ?: 'noreply@dae.com'; // Cache configuration $CFG->cachestores = [ 'redis' => [ 'class' => 'cachestore_redis', 'configuration' => [ 'server' => getenv('REDIS_HOST') ?: '127.0.0.1', 'port' => 6379, 'password' => getenv('REDIS_AUTH') ?: '', ], ], ]; // Force HTTPS $CFG->sslproxy = true; $CFG->loginhttps = true; // Debugging (disable in production) $CFG->debug = 0; $CFG->debugdisplay = 0; require_once(__DIR__ . '/lib/setup.php');
